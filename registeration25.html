<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Event Registration</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .form-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 600px;
            position: relative;
            overflow: hidden;
        }
        
        .form-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #667eea, #764ba2);
        }
        
        .form-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .form-title {
            color: #333;
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .form-subtitle {
            color: #666;
            font-size: 1.1rem;
        }
        
        .form-step {
            display: none;
        }
        
        .form-step.active {
            display: block;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
            font-size: 0.9rem;
        }
        
        .form-input {
            width: 100%;
            padding: 15px 20px;
            border: 2px solid #e1e5e9;
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: #fff;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .form-select {
            appearance: none;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 12px center;
            background-repeat: no-repeat;
            background-size: 16px;
        }
        
        .stalls-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .stall-option {
            position: relative;
        }
        
        .stall-checkbox {
            position: absolute;
            opacity: 0;
            cursor: pointer;
        }
        
        .stall-card {
            display: block;
            padding: 20px;
            border: 2px solid #e1e5e9;
            border-radius: 15px;
            background: #fff;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }
        
        .stall-card:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.15);
        }
        
        .stall-checkbox:checked + .stall-card {
            border-color: #667eea;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
        }
        
        .stall-icon {
            font-size: 2rem;
            margin-bottom: 10px;
            display: block;
        }
        
        .stall-name {
            font-weight: 600;
            color: #333;
            font-size: 1rem;
        }
        
        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            width: 100%;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }
        
        .btn-secondary {
            background: #f8f9fa;
            color: #666;
            margin-right: 15px;
        }
        
        .btn-secondary:hover {
            background: #e9ecef;
        }
        
        .error-message {
            color: #e74c3c;
            font-size: 0.85rem;
            margin-top: 5px;
            display: none;
        }
        
        .progress-bar {
            height: 4px;
            background: #e1e5e9;
            border-radius: 2px;
            margin-bottom: 30px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transition: width 0.3s ease;
            width: 50%;
        }
        
        .form-buttons {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 30px;
        }
        
        @media (max-width: 768px) {
            .form-container {
                padding: 30px 20px;
            }
            
            .form-title {
                font-size: 2rem;
            }
            
            .stalls-grid {
                grid-template-columns: 1fr;
            }
            
            .form-buttons {
                flex-direction: column;
                gap: 15px;
            }
            
            .btn-secondary {
                margin-right: 0;
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="form-container">
        <div class="form-header">
            <h1 class="form-title">Event Registration</h1>
            <p class="form-subtitle">Join us for an amazing experience</p>
        </div>
        
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>
        
        <form id="registrationForm">
            <!-- Step 1: Personal Information -->
            <div class="form-step active" id="step1">
                <div class="form-group">
                    <label class="form-label" for="name">Full Name *</label>
                    <input type="text" id="name" name="name" class="form-input" required>
                    <div class="error-message" id="nameError">Please enter your full name</div>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="number">Phone Number *</label>
                    <input type="tel" id="number" name="number" class="form-input" required pattern="[0-9]{10}">
                    <div class="error-message" id="numberError">Please enter a valid 10-digit phone number</div>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="class">Class/Grade *</label>
                    <select id="class" name="class" class="form-input form-select" required>
                        <option value="">Select your class</option>
                        <option value="1">Class 1</option>
                        <option value="2">Class 2</option>
                        <option value="3">Class 3</option>
                        <option value="4">Class 4</option>
                        <option value="5">Class 5</option>
                        <option value="6">Class 6</option>
                        <option value="7">Class 7</option>
                        <option value="8">Class 8</option>
                        <option value="9">Class 9</option>
                        <option value="10">Class 10</option>
                        <option value="11">Class 11</option>
                        <option value="12">Class 12</option>
                        <option value="undergraduate">Undergraduate</option>
                        <option value="postgraduate">Postgraduate</option>
                        <option value="other">Other</option>
                    </select>
                    <div class="error-message" id="classError">Please select your class</div>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="school">School/Institution *</label>
                    <input type="text" id="school" name="school" class="form-input" required>
                    <div class="error-message" id="schoolError">Please enter your school/institution name</div>
                </div>
                
                <!-- District Dropdown -->
                <div class="form-group">
                <label class="form-label" for="district">District *</label>
                <select id="district" name="district" class="form-input form-select" required>
                    <option value="">Loading districts...</option>
                </select>
                <div class="error-message" id="districtError">Please select your district</div>
                </div>

                <!-- Division Dropdown -->
                <div class="form-group">
                <label class="form-label" for="division">Division *</label>
                <select id="division" name="division" class="form-input form-select" required>
                    <option value="">Select a district first</option>
                </select>
                <div class="error-message" id="divisionError">Please select your division</div>
                </div>

                <!-- Sector Dropdown -->
                <div class="form-group">
                <label class="form-label" for="sector">Sector *</label>
                <select id="sector" name="sector" class="form-input form-select" required>
                    <option value="">Select a division first</option>
                </select>
                <div class="error-message" id="sectorError">Please select your sector</div>
                </div>
            </div>
            
            <!-- Step 2: Stall Selection -->
            <div class="form-step" id="step2">
                <h2 style="text-align: center; margin-bottom: 20px; color: #333;">Select Stalls to Visit</h2>
                <p style="text-align: center; margin-bottom: 30px; color: #666;">Choose one or more stalls you'd like to participate in</p>
                
                <div class="stalls-grid">
                    <div class="stall-option">
                        <input type="checkbox" id="career-clinic" name="stalls[]" value="career-clinic" class="stall-checkbox">
                        <label for="career-clinic" class="stall-card">
                            <span class="stall-icon">💼</span>
                            <span class="stall-name">Career Clinic</span>
                        </label>
                    </div>
                    
                    <div class="stall-option">
                        <input type="checkbox" id="coding-lab" name="stalls[]" value="coding-lab" class="stall-checkbox">
                        <label for="coding-lab" class="stall-card">
                            <span class="stall-icon">💻</span>
                            <span class="stall-name">Coding Lab</span>
                        </label>
                    </div>
                    
                    <div class="stall-option">
                        <input type="checkbox" id="diy-science" name="stalls[]" value="diy-science" class="stall-checkbox">
                        <label for="diy-science" class="stall-card">
                            <span class="stall-icon">🔬</span>
                            <span class="stall-name">DIY Science World</span>
                        </label>
                    </div>
                    
                    <div class="stall-option">
                        <input type="checkbox" id="design-zone" name="stalls[]" value="design-zone" class="stall-checkbox">
                        <label for="design-zone" class="stall-card">
                            <span class="stall-icon">🎨</span>
                            <span class="stall-name">Design Zone</span>
                        </label>
                    </div>
                    
                    <div class="stall-option">
                        <input type="checkbox" id="robotics" name="stalls[]" value="robotics" class="stall-checkbox">
                        <label for="robotics" class="stall-card">
                            <span class="stall-icon">🤖</span>
                            <span class="stall-name">Robotics</span>
                        </label>
                    </div>
                    
                    <div class="stall-option">
                        <input type="checkbox" id="cv-interview" name="stalls[]" value="cv-interview" class="stall-checkbox">
                        <label for="cv-interview" class="stall-card">
                            <span class="stall-icon">📝</span>
                            <span class="stall-name">CV & Interview PrepZone</span>
                        </label>
                    </div>
                    
                    <div class="stall-option">
                        <input type="checkbox" id="tci-workshops" name="stalls[]" value="tci-workshops" class="stall-checkbox">
                        <label for="tci-workshops" class="stall-card">
                            <span class="stall-icon">🎯</span>
                            <span class="stall-name">TCI Workshops</span>
                        </label>
                    </div>
                    
                    <div class="stall-option">
                        <input type="checkbox" id="listening-clinic" name="stalls[]" value="listening-clinic" class="stall-checkbox">
                        <label for="listening-clinic" class="stall-card">
                            <span class="stall-icon">👂</span>
                            <span class="stall-name">Listening Clinic</span>
                        </label>
                    </div>
                    
                    <div class="stall-option">
                        <input type="checkbox" id="puzzle-corner" name="stalls[]" value="puzzle-corner" class="stall-checkbox">
                        <label for="puzzle-corner" class="stall-card">
                            <span class="stall-icon">🧩</span>
                            <span class="stall-name">Puzzle Corner</span>
                        </label>
                    </div>
                    
                    <div class="stall-option">
                        <input type="checkbox" id="treasure-hunt" name="stalls[]" value="treasure-hunt" class="stall-checkbox">
                        <label for="treasure-hunt" class="stall-card">
                            <span class="stall-icon">🗺️</span>
                            <span class="stall-name">Treasure Hunt</span>
                        </label>
                    </div>
                </div>
                
                <div class="error-message" id="stallsError" style="text-align: center; margin-top: -20px; margin-bottom: 20px;">Please select at least one stall</div>
            </div>
            
            <div class="form-buttons">
                <button type="button" id="backBtn" class="btn btn-secondary" style="display: none;">← Back</button>
                <button type="button" id="nextBtn" class="btn btn-primary">Next →</button>
                <button type="submit" id="submitBtn" class="btn btn-primary" style="display: none;">Complete Registration 🎉</button>
            </div>
        </form>
    </div>
    
    <script>
        let districtData = {};

        // Replace this with your actual deployed Apps Script URL
        const dataURL = 'https://script.google.com/macros/s/AKfycbw_0MLACwooB9jjjCv8P6L_Kb3ABIjk_JnnWP2Ezz7_EbNcuwAWZV5u2iJVmDZvfhTD/exec';

        // Fetch and populate district dropdown
        fetch(dataURL)
        .then(res => res.json())
        .then(data => {
            districtData = data;
            const districtSelect = document.getElementById('district');
            districtSelect.innerHTML = '<option value="">Select your district</option>';

            Object.keys(districtData).forEach(district => {
            const option = document.createElement('option');
            option.value = district;
            option.textContent = district;
            districtSelect.appendChild(option);
            });
        });

        // On selecting district → populate divisions
        document.getElementById('district').addEventListener('change', function () {
        const selectedDistrict = this.value;
        const divisionSelect = document.getElementById('division');
        divisionSelect.innerHTML = '<option value="">Select your division</option>';
        document.getElementById('sector').innerHTML = '<option value="">Select a division first</option>';

        if (districtData[selectedDistrict]) {
            Object.keys(districtData[selectedDistrict]).forEach(division => {
            const option = document.createElement('option');
            option.value = division;
            option.textContent = division;
            divisionSelect.appendChild(option);
            });
        }
        });

        // On selecting division → populate sectors
        document.getElementById('division').addEventListener('change', function () {
        const selectedDistrict = document.getElementById('district').value;
        const selectedDivision = this.value;
        const sectorSelect = document.getElementById('sector');
        sectorSelect.innerHTML = '<option value="">Select your sector</option>';

        if (
            districtData[selectedDistrict] &&
            districtData[selectedDistrict][selectedDivision]
        ) {
            districtData[selectedDistrict][selectedDivision].forEach(sector => {
            const option = document.createElement('option');
            option.value = sector;
            option.textContent = sector;
            sectorSelect.appendChild(option);
            });
        }
        });

        // Multi-step form logic
        document.addEventListener('DOMContentLoaded', function () {
            const steps = document.querySelectorAll('.form-step');
            const nextBtn = document.getElementById('nextBtn');
            const backBtn = document.getElementById('backBtn');
            const submitBtn = document.getElementById('submitBtn');
            const progressFill = document.getElementById('progressFill');
            let currentStep = 0;

            function showStep(step) {
                steps.forEach((el, idx) => {
                    el.classList.toggle('active', idx === step);
                });
                backBtn.style.display = step === 0 ? 'none' : '';
                nextBtn.style.display = step === steps.length - 1 ? 'none' : '';
                submitBtn.style.display = step === steps.length - 1 ? '' : 'none';
                if (progressFill) {
                    progressFill.style.width = ((step + 1) / steps.length * 100) + '%';
                }
            }

            nextBtn.addEventListener('click', function () {
                showStep(++currentStep);
            });

            backBtn.addEventListener('click', function () {
                showStep(--currentStep);
            });

            showStep(currentStep);

            document.getElementById('registrationForm').addEventListener('submit', function(e) {
                e.preventDefault();

                const form = e.target;
                const formData = new FormData(form);

                const stalls = [];
                form.querySelectorAll('input[name="stalls[]"]:checked').forEach(cb => {
                    stalls.push(cb.value);
                });

                const params = new URLSearchParams();
                params.append('name', formData.get('name') || '');
                params.append('number', formData.get('number') || '');
                params.append('class', formData.get('class') || '');
                params.append('school', formData.get('school') || '');
                params.append('district', formData.get('district') || '');
                params.append('division', formData.get('division') || '');
                params.append('sector', formData.get('sector') || '');
                params.append('stalls', stalls.join(','));

                console.log('Submitting data:', Object.fromEntries(params));

                fetch(dataURL + '?' + params.toString())
                    .then(res => res.json())
                    .then(response => {
                        console.log('Server response:', response);
                        alert('Registration successful!');
                        form.reset();
                        currentStep = 0;
                        showStep(currentStep);
                    })
                    .catch(err => {
                        console.error('Submission error:', err);
                        alert('There was an error submitting your registration.');
                    });
            });
        });
    </script>
</body>
</html>